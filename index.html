<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Language Learning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1D3557 0%, #06B6D4 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: #FAFAFA;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #1D3557;
            font-size: 1.8rem;
        }

        .language-selector {
            background: #FAFAFA;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .language-flags {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .flag-option {
            cursor: pointer;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .flag-option:hover {
            transform: translateY(-5px);
            border-color: #06B6D4;
        }

        .flag-option.selected {
            border-color: #F97316;
            background: #FFF7ED;
        }

        .flag {
            font-size: 4rem;
            margin-bottom: 10px;
            display: block;
        }

        .flag-label {
            font-weight: 600;
            color: #1D3557;
        }

        .topic-selector {
            background: #FAFAFA;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .topics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .topic-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .topic-card:hover {
            transform: translateY(-3px);
            border-color: #06B6D4;
        }

        .topic-card.selected {
            border-color: #F97316;
            background: #FFF7ED;
        }

        .topic-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .session-settings {
            background: #FAFAFA;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .number-selector {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: #F97316;
            color: white;
        }

        .btn-primary:hover {
            background: #ea580c;
            transform: translateY(-2px);
        }

        .number-btn {
            padding: 8px 16px;
            border: 2px solid #E5E7EB;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .number-btn.selected {
            background: #F97316;
            color: white;
            border-color: #F97316;
        }

        /* NEW FLASHCARD STYLES */
        .flashcard-container {
            position: relative;
            margin: 30px auto;
            width: 100%;
            max-width: 500px;
            height: 400px;
            perspective: 1000px;
        }

        .card-stack {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* Background cards to create stack effect */
        .card-stack::before,
        .card-stack::after {
            content: '';
            position: absolute;
            width: 95%;
            height: 95%;
            background: #f8f9fa;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            z-index: 1;
        }

        .card-stack::before {
            top: 12px;
            left: 2.5%;
            transform: rotate(-2deg);
            background: #e9ecef;
        }

        .card-stack::after {
            top: 6px;
            left: 2.5%;
            transform: rotate(1deg);
            background: #f1f3f4;
        }

        .flashcard {
            position: relative;
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 40px 30px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.4s ease;
            border: 2px solid #e2e8f0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.07);
            z-index: 3;
            position: relative;
            transform-style: preserve-3d;
        }

        .flashcard.flipped {
            background: linear-gradient(145deg, #f0f9ff 0%, #e0f2fe 100%);
            border-color: #0ea5e9;
            box-shadow: 0 20px 40px rgba(14, 165, 233, 0.2), 0 8px 20px rgba(14, 165, 233, 0.1);
        }

        .flashcard:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15), 0 10px 20px rgba(0,0,0,0.1);
        }

        .card-number {
            position: absolute;
            top: 20px;
            right: 25px;
            background: rgba(29, 53, 87, 0.1);
            color: #1D3557;
            font-size: 0.9rem;
            font-weight: 700;
            padding: 6px 14px;
            border-radius: 20px;
            border: 2px solid rgba(29, 53, 87, 0.2);
        }

        .card-content {
            font-size: 2.4rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            line-height: 1.2;
            color: #1e293b;
        }

        .card-context {
            font-size: 1.1rem;
            color: #64748b;
            text-align: center;
            margin-bottom: 25px;
            font-style: italic;
            background: rgba(59, 130, 246, 0.1);
            padding: 12px 20px;
            border-radius: 25px;
            border: 2px solid rgba(59, 130, 246, 0.2);
            font-weight: 500;
        }

        .card-hint {
            font-size: 1rem;
            color: #94a3b8;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .pronunciation-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(59, 130, 246, 0.2);
        }

        .pronunciation-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .pronunciation-btn.speaking {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            animation: cardPulse 1s infinite;
            box-shadow: 0 12px 25px rgba(245, 158, 11, 0.4);
        }

        .flip-btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);
            margin-top: auto;
        }

        .flip-btn:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(139, 92, 246, 0.4);
        }

        @keyframes cardPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn-correct {
            background: #A7C957;
            color: white;
        }

        .btn-wrong {
            background: #FF8C82;
            color: white;
        }

        .btn-next {
            background: #06B6D4;
            color: white;
        }

        .hidden {
            display: none;
        }

        .progress-section {
            background: #FAFAFA;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .cefr-badge {
            background: #A7C957;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
        }

        @media (max-width: 768px) {
            .language-flags {
                flex-direction: column;
                align-items: center;
            }
            
            .flashcard-container {
                height: 350px;
            }
            
            .card-content {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🌍 Travel Language Learning</h1>
            <p>Ready to learn!</p>
        </div>

        <!-- Language Selection -->
        <div id="languageSelection" class="language-selector">
            <h2>Choose your language to learn</h2>
            <div class="language-flags">
                <div class="flag-option" onclick="selectLanguage('spanish')">
                    <span class="flag" style="background: linear-gradient(to bottom, #AA151B 33%, #F1BF00 33%, #F1BF00 66%, #AA151B 66%); color: transparent; border-radius: 8px; display: block; width: 80px; height: 60px; margin: 0 auto 10px;">ES</span>
                    <div class="flag-label">Spanish</div>
                </div>
                <div class="flag-option" onclick="selectLanguage('french')">
                    <span class="flag" style="background: linear-gradient(to right, #002395 33%, #FFFFFF 33%, #FFFFFF 66%, #ED2939 66%); color: transparent; border-radius: 8px; display: block; width: 80px; height: 60px; margin: 0 auto 10px;">FR</span>
                    <div class="flag-label">French</div>
                </div>
                <div class="flag-option" onclick="selectLanguage('italian')">
                    <span class="flag" style="background: linear-gradient(to right, #009246 33%, #FFFFFF 33%, #FFFFFF 66%, #CE2B37 66%); color: transparent; border-radius: 8px; display: block; width: 80px; height: 60px; margin: 0 auto 10px;">IT</span>
                    <div class="flag-label">Italian</div>
                </div>
            </div>
        </div>

        <!-- Learning Interface -->
        <div id="learningInterface" class="hidden">
            <!-- Progress Display -->
            <div class="progress-section">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span class="cefr-badge" id="cefrLevel">A1</span>
                        <span id="selectedLanguage" style="margin-left: 10px; font-weight: 600;"></span>
                    </div>
                    <button class="btn btn-primary" onclick="showLanguageSelection()">Change Language</button>
                </div>
                <div style="margin-top: 10px;">
                    <span id="overallProgress">Session: 0/0 | Score: 0%</span>
                </div>
            </div>

            <!-- Topic Selection -->
            <div id="topicSelection" class="topic-selector">
                <h3>Choose your focus area</h3>
                <div class="topics">
                    <div class="topic-card" onclick="selectTopic('restaurant')">
                        <div class="topic-icon">🍽️</div>
                        <div>Restaurant</div>
                    </div>
                    <div class="topic-card" onclick="selectTopic('transportation')">
                        <div class="topic-icon">🚊</div>
                        <div>Transportation</div>
                    </div>
                    <div class="topic-card" onclick="selectTopic('social')">
                        <div class="topic-icon">👥</div>
                        <div>Social</div>
                    </div>
                </div>
            </div>

            <!-- Session Settings -->
            <div id="sessionSettings" class="session-settings hidden">
                <div class="settings-row">
                    <span style="font-weight: 600;">Activity Type:</span>
                    <div class="number-selector">
                        <button class="number-btn selected" onclick="selectActivity('flashcard')">Flashcards</button>
                        <button class="number-btn" onclick="selectActivity('quiz')">Quiz</button>
                    </div>
                </div>
                <div class="settings-row">
                    <span style="font-weight: 600;">Number of items:</span>
                    <div class="number-selector">
                        <button class="number-btn" onclick="selectNumber(10)">10</button>
                        <button class="number-btn selected" onclick="selectNumber(15)">15</button>
                        <button class="number-btn" onclick="selectNumber(20)">20</button>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="startSession()">Start Learning</button>
                </div>
            </div>

            <!-- Learning Session -->
            <div id="learningSession" class="hidden">
                <div class="flashcard-container">
                    <div class="card-stack">
                        <div class="flashcard" id="flashcard">
                            <div class="card-number" id="cardNumber">1 / 15</div>
                            <div class="card-content" id="cardContent">Click to start!</div>
                            <div class="card-context" id="cardContext"></div>
                            <div class="card-hint" id="cardHint">Click to see translation</div>
                            <button class="flip-btn" id="flipButton" onclick="flipCard()" style="display: none;">Flip Card</button>
                        </div>
                    </div>
                </div>
                <div class="action-buttons" id="flashcardButtons" style="display: none;">
                    <button class="btn btn-correct" onclick="markCorrect()">✓ I knew this</button>
                    <button class="btn btn-wrong" onclick="markWrong()">✗ I didn't know</button>
                    <button class="btn btn-next" onclick="nextCard()">Next →</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log("JavaScript is loading!");

        // Global state
        let selectedLanguage = null;
        let selectedTopic = null;
        let activityType = 'flashcard';
        let sessionSize = 15;
        let currentSession = [];
        let currentIndex = 0;
        let sessionScore = { correct: 0, wrong: 0 };
        let isFlipped = false;

        // Audio synthesis setup
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;

        // Language voice mapping
        const languageVoices = {
            spanish: 'es-ES',
            french: 'fr-FR', 
            italian: 'it-IT'
        };

        // Audio pronunciation function
        function pronounceText(text, language, event) {
            // Prevent the card from flipping when clicking the speaker button
            if (event) {
                event.stopPropagation();
            }

            // Stop any current speech
            if (currentUtterance) {
                speechSynthesis.cancel();
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = languageVoices[language] || 'en-US';
            utterance.rate = 0.8; // Slightly slower for learning
            utterance.pitch = 1;
            utterance.volume = 1;

            // Visual feedback
            const button = document.querySelector('.pronunciation-btn');
            if (button) {
                button.classList.add('speaking');
                button.innerHTML = '🔊';
            }

            utterance.onend = function() {
                if (button) {
                    button.classList.remove('speaking');
                    button.innerHTML = '🔊';
                }
                currentUtterance = null;
            };

            utterance.onerror = function() {
                if (button) {
                    button.classList.remove('speaking');
                    button.innerHTML = '🔊';
                }
                currentUtterance = null;
                console.log('Speech synthesis error');
            };

            currentUtterance = utterance;
            speechSynthesis.speak(utterance);
        }

        const content = {
            spanish: {
                restaurant: [
                    { spanish: "Una mesa para dos", english: "A table for two", context: "Arriving at restaurant" },
                    { spanish: "La cuenta, por favor", english: "The bill, please", context: "Paying" },
                    { spanish: "¿Qué recomienda?", english: "What do you recommend?", context: "Asking for suggestions" },
                    { spanish: "Soy vegetariano", english: "I am vegetarian", context: "Dietary preferences" },
                    { spanish: "Agua, por favor", english: "Water, please", context: "Ordering drinks" },
                    { spanish: "¿Tienen menú en inglés?", english: "Do you have a menu in English?", context: "Requesting assistance" },
                    { spanish: "Está muy delicioso", english: "It's very delicious", context: "Complimenting food" },
                    { spanish: "¿Cuál es el plato del día?", english: "What is the dish of the day?", context: "Daily specials" },
                    { spanish: "Sin sal, por favor", english: "Without salt, please", context: "Special requests" },
                    { spanish: "¿Aceptan tarjetas de crédito?", english: "Do you accept credit cards?", context: "Payment method" }
                ],
                transportation: [
                    { spanish: "¿Dónde está la estación?", english: "Where is the station?", context: "Finding locations" },
                    { spanish: "Un billete a Madrid", english: "A ticket to Madrid", context: "Buying tickets" },
                    { spanish: "¿Cuánto cuesta?", english: "How much does it cost?", context: "Asking price" },
                    { spanish: "¿A qué hora sale?", english: "What time does it leave?", context: "Departure times" },
                    { spanish: "Taxi, por favor", english: "Taxi, please", context: "Calling transport" },
                    { spanish: "¿Hay descuento para estudiantes?", english: "Is there a student discount?", context: "Discounts" },
                    { spanish: "¿En qué andén?", english: "On which platform?", context: "Train information" },
                    { spanish: "¿Cuánto tiempo tarda?", english: "How long does it take?", context: "Journey duration" },
                    { spanish: "¿Hay conexión directa?", english: "Is there a direct connection?", context: "Route planning" },
                    { spanish: "He perdido mi equipaje", english: "I have lost my luggage", context: "Problems" }
                ],
                social: [
                    { spanish: "¿Cómo te llamas?", english: "What's your name?", context: "Introductions" },
                    { spanish: "Mucho gusto", english: "Nice to meet you", context: "Polite responses" },
                    { spanish: "¿De dónde eres?", english: "Where are you from?", context: "Getting to know someone" },
                    { spanish: "Habla más despacio", english: "Speak more slowly", context: "Communication help" },
                    { spanish: "No hablo español muy bien", english: "I don't speak Spanish very well", context: "Language barriers" },
                    { spanish: "¿Qué planes tienes?", english: "What plans do you have?", context: "Making plans" },
                    { spanish: "¿Te gusta la ciudad?", english: "Do you like the city?", context: "Opinions" },
                    { spanish: "¿Puedes ayudarme?", english: "Can you help me?", context: "Asking for help" },
                    { spanish: "¿Dónde vives?", english: "Where do you live?", context: "Personal information" },
                    { spanish: "¿Quieres tomar algo?", english: "Do you want to have a drink?", context: "Social invitations" }
                ]
            },
            french: {
                restaurant: [
                    { french: "Une table pour deux", english: "A table for two", context: "Arriving at restaurant" },
                    { french: "L'addition, s'il vous plaît", english: "The bill, please", context: "Paying" },
                    { french: "Que recommandez-vous?", english: "What do you recommend?", context: "Asking for suggestions" },
                    { french: "Je suis végétarien", english: "I am vegetarian", context: "Dietary preferences" },
                    { french: "De l'eau, s'il vous plaît", english: "Water, please", context: "Ordering drinks" },
                    { french: "Avez-vous un menu en anglais?", english: "Do you have a menu in English?", context: "Requesting assistance" },
                    { french: "C'est très délicieux", english: "It's very delicious", context: "Complimenting food" },
                    { french: "Quel est le plat du jour?", english: "What is the dish of the day?", context: "Daily specials" },
                    { french: "Sans sel, s'il vous plaît", english: "Without salt, please", context: "Special requests" },
                    { french: "Acceptez-vous les cartes de crédit?", english: "Do you accept credit cards?", context: "Payment method" }
                ],
                transportation: [
                    { french: "Où est la gare?", english: "Where is the station?", context: "Finding locations" },
                    { french: "Un billet pour Paris", english: "A ticket to Paris", context: "Buying tickets" },
                    { french: "Combien ça coûte?", english: "How much does it cost?", context: "Asking price" },
                    { french: "À quelle heure part-il?", english: "What time does it leave?", context: "Departure times" },
                    { french: "Taxi, s'il vous plaît", english: "Taxi, please", context: "Calling transport" },
                    { french: "Y a-t-il une réduction étudiante?", english: "Is there a student discount?", context: "Discounts" },
                    { french: "Sur quel quai?", english: "On which platform?", context: "Train information" },
                    { french: "Combien de temps ça prend?", english: "How long does it take?", context: "Journey duration" },
                    { french: "Y a-t-il une connexion directe?", english: "Is there a direct connection?", context: "Route planning" },
                    { french: "J'ai perdu mes bagages", english: "I have lost my luggage", context: "Problems" }
                ],
                social: [
                    { french: "Comment vous appelez-vous?", english: "What's your name?", context: "Introductions" },
                    { french: "Enchanté", english: "Nice to meet you", context: "Polite responses" },
                    { french: "D'où venez-vous?", english: "Where are you from?", context: "Getting to know someone" },
                    { french: "Parlez plus lentement", english: "Speak more slowly", context: "Communication help" },
                    { french: "Je ne parle pas très bien français", english: "I don't speak French very well", context: "Language barriers" },
                    { french: "Quels sont vos projets?", english: "What are your plans?", context: "Making plans" },
                    { french: "Aimez-vous la ville?", english: "Do you like the city?", context: "Opinions" },
                    { french: "Pouvez-vous m'aider?", english: "Can you help me?", context: "Asking for help" },
                    { french: "Où habitez-vous?", english: "Where do you live?", context: "Personal information" },
                    { french: "Voulez-vous prendre un verre?", english: "Do you want to have a drink?", context: "Social invitations" }
                ]
            },
            italian: {
                restaurant: [
                    { italian: "Un tavolo per due", english: "A table for two", context: "Arriving at restaurant" },
                    { italian: "Il conto, per favore", english: "The bill, please", context: "Paying" },
                    { italian: "Cosa raccomanda?", english: "What do you recommend?", context: "Asking for suggestions" },
                    { italian: "Sono vegetariano", english: "I am vegetarian", context: "Dietary preferences" },
                    { italian: "Acqua, per favore", english: "Water, please", context: "Ordering drinks" },
                    { italian: "Avete un menu in inglese?", english: "Do you have a menu in English?", context: "Requesting assistance" },
                    { italian: "È molto delizioso", english: "It's very delicious", context: "Complimenting food" },
                    { italian: "Qual è il piatto del giorno?", english: "What is the dish of the day?", context: "Daily specials" },
                    { italian: "Senza sale, per favore", english: "Without salt, please", context: "Special requests" },
                    { italian: "Accettate carte di credito?", english: "Do you accept credit cards?", context: "Payment method" }
                ],
                transportation: [
                    { italian: "Dove è la stazione?", english: "Where is the station?", context: "Finding locations" },
                    { italian: "Un biglietto per Roma", english: "A ticket to Rome", context: "Buying tickets" },
                    { italian: "Quanto costa?", english: "How much does it cost?", context: "Asking price" },
                    { italian: "A che ora parte?", english: "What time does it leave?", context: "Departure times" },
                    { italian: "Taxi, per favore", english: "Taxi, please", context: "Calling transport" },
                    { italian: "C'è uno sconto per studenti?", english: "Is there a student discount?", context: "Discounts" },
                    { italian: "Su quale binario?", english: "On which platform?", context: "Train information" },
                    { italian: "Quanto tempo ci vuole?", english: "How long does it take?", context: "Journey duration" },
                    { italian: "C'è una connessione diretta?", english: "Is there a direct connection?", context: "Route planning" },
                    { italian: "Ho perso i miei bagagli", english: "I have lost my luggage", context: "Problems" }
                ],
                social: [
                    { italian: "Come ti chiami?", english: "What's your name?", context: "Introductions" },
                    { italian: "Piacere di conoscerti", english: "Nice to meet you", context: "Polite responses" },
                    { italian: "Di dove sei?", english: "Where are you from?", context: "Getting to know someone" },
                    { italian: "Parla più lentamente", english: "Speak more slowly", context: "Communication help" },
                    { italian: "Non parlo molto bene italiano", english: "I don't speak Italian very well", context: "Language barriers" },
                    { italian: "Che piani hai?", english: "What plans do you have?", context: "Making plans" },
                    { italian: "Ti piace la città?", english: "Do you like the city?", context: "Opinions" },
                    { italian: "Puoi aiutarmi?", english: "Can you help me?", context: "Asking for help" },
                    { italian: "Dove vivi?", english: "Where do you live?", context: "Personal information" },
                    { italian: "Vuoi prendere qualcosa da bere?", english: "Do you want to have a drink?", context: "Social invitations" }
                ]
            }
        };

        // Initialize app on page load
        window.onload = function() {
            showLanguageSelection();
        };

        function showLanguageSelection() {
            hideAllSections();
            document.getElementById('languageSelection').classList.remove('hidden');
        }

        function selectLanguage(language) {
            selectedLanguage = language;
            
            // Update visual selection
            document.querySelectorAll('.flag-option').forEach(flag => {
                flag.classList.remove('selected');
            });
            
            // Find the clicked flag
            const flags = document.querySelectorAll('.flag-option');
            flags.forEach(flag => {
                if (flag.onclick && flag.onclick.toString().includes(language)) {
                    flag.classList.add('selected');
                }
            });
            
            // Update display
            document.getElementById('selectedLanguage').textContent = language.charAt(0).toUpperCase() + language.slice(1);
            
            // Show learning interface
            setTimeout(() => {
                document.getElementById('languageSelection').classList.add('hidden');
                document.getElementById('learningInterface').classList.remove('hidden');
            }, 500);
        }

        function selectTopic(topic) {
            console.log("Topic selected:", topic);
            selectedTopic = topic;
            
            // Update visual selection
            document.querySelectorAll('.topic-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Find clicked topic
            const topics = document.querySelectorAll('.topic-card');
            topics.forEach(card => {
                if (card.onclick && card.onclick.toString().includes(topic)) {
                    card.classList.add('selected');
                }
            });
            
            // Show session settings
            setTimeout(() => {
                document.getElementById('sessionSettings').classList.remove('hidden');
            }, 300);
        }

        function selectActivity(activity) {
            activityType = activity;
            
            document.querySelectorAll('.number-selector .number-btn').forEach(btn => {
                if (btn.textContent === 'Flashcards' || btn.textContent === 'Quiz') {
                    btn.classList.remove('selected');
                }
            });
            
            // Find clicked button
            const btns = document.querySelectorAll('.number-selector .number-btn');
            btns.forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes(activity)) {
                    btn.classList.add('selected');
                }
            });
        }

        function selectNumber(number) {
            sessionSize = number;
            
            document.querySelectorAll('.number-selector .number-btn').forEach(btn => {
                if (btn.textContent === '10' || btn.textContent === '15' || btn.textContent === '20') {
                    btn.classList.remove('selected');
                }
            });
            
            // Find clicked button
            const btns = document.querySelectorAll('.number-selector .number-btn');
            btns.forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes(number.toString())) {
                    btn.classList.add('selected');
                }
            });
        }

        function startSession() {
            console.log("Starting session:", selectedLanguage, selectedTopic, activityType, sessionSize);
            
            // Prepare session
            currentIndex = 0;
            sessionScore = { correct: 0, wrong: 0 };
            currentSession = content[selectedLanguage][selectedTopic] || [];
            
            // Show learning session
            document.getElementById('topicSelection').classList.add('hidden');
            document.getElementById('sessionSettings').classList.add('hidden');
            document.getElementById('learningSession').classList.remove('hidden');
            
            showFlashcard();
        }

        function showFlashcard() {
            if (currentIndex >= currentSession.length) {
                showSessionResults();
                return;
            }
            
            const card = currentSession[currentIndex];
            const foreignText = card[selectedLanguage] || card.spanish || card.french || card.italian;
            
            // Update card number
            document.getElementById('cardNumber').textContent = `${currentIndex + 1} / ${currentSession.length}`;
            
            // Update card content with pronunciation button
            document.getElementById('cardContent').innerHTML = `
                <span>${foreignText}</span>
                <button class="pronunciation-btn" onclick="pronounceText('${foreignText.replace(/'/g, "\\'")}', '${selectedLanguage}', event)" title="Listen to pronunciation">
                    🔊
                </button>
            `;
            
            document.getElementById('cardContext').textContent = card.context;
            document.getElementById('cardHint').textContent = 'Click 🔊 to hear pronunciation • Click "Flip" to see translation';
            document.getElementById('flashcard').classList.remove('flipped');
            document.getElementById('flashcardButtons').style.display = 'none';
            
            // Show flip button, hide action buttons
            document.getElementById('flipButton').style.display = 'block';
            document.getElementById('flipButton').textContent = 'Flip Card';
            
            isFlipped = false;
            updateProgress();
        }

        function flipCard() {
            if (isFlipped) return;
            
            const card = currentSession[currentIndex];
            const englishText = card.english;
            
            // Update to show English translation with pronunciation for foreign text
            const foreignText = card[selectedLanguage] || card.spanish || card.french || card.italian;
            document.getElementById('cardContent').innerHTML = `
                <span>${englishText}</span>
                <button class="pronunciation-btn" onclick="pronounceText('${foreignText.replace(/'/g, "\\'")}', '${selectedLanguage}', event)" title="Listen to pronunciation">
                    🔊
                </button>
            `;
            
            document.getElementById('cardHint').textContent = 'How did you do? • Click 🔊 to hear the foreign phrase again';
            document.getElementById('flashcard').classList.add('flipped');
            
            // Hide flip button, show action buttons
            document.getElementById('flipButton').style.display = 'none';
            document.getElementById('flashcardButtons').style.display = 'flex';
            
            isFlipped = true;
        }

        function markCorrect() {
            sessionScore.correct++;
            updateProgress();
        }

        function markWrong() {
            sessionScore.wrong++;
            updateProgress();
        }

        function nextCard() {
            currentIndex++;
            showFlashcard();
        }

        function updateProgress() {
            const total = sessionScore.correct + sessionScore.wrong;
            const percentage = total > 0 ? Math.round((sessionScore.correct / total) * 100) : 0;
            document.getElementById('overallProgress').textContent = 
                `Session: ${total}/${sessionSize} | Score: ${percentage}%`;
        }

        function showSessionResults() {
            const total = sessionScore.correct + sessionScore.wrong;
            const percentage = Math.round((sessionScore.correct / total) * 100);
            
            if (percentage >= 75) {
                // Show congratulations screen
                showCongratulations(percentage, total);
            } else {
                // Show try again screen
                showTryAgain(percentage, total);
            }
        }

        function showCongratulations(percentage, total) {
            const congratsHTML = `
                <div style="background: #FAFAFA; padding: 40px; border-radius: 15px; text-align: center;">
                    <h2 style="color: #A7C957; font-size: 2.5rem; margin-bottom: 20px;">🎉 Congratulations!</h2>
                    <div style="font-size: 1.5rem; margin-bottom: 20px;">
                        Great job! You scored ${sessionScore.correct}/${total} (${percentage}%)
                    </div>
                    <div style="margin-bottom: 30px; color: #666;">
                        You've mastered this topic!
                    </div>
                    <button class="btn btn-primary" onclick="returnToLanguageHome()">Continue Learning</button>
                </div>
            `;
            
            document.getElementById('learningSession').innerHTML = congratsHTML;
        }

        function showTryAgain(percentage, total) {
            const tryAgainHTML = `
                <div style="background: #FAFAFA; padding: 40px; border-radius: 15px; text-align: center;">
                    <h2 style="color: #F97316; font-size: 2rem; margin-bottom: 20px;">Keep Practicing!</h2>
                    <div style="font-size: 1.5rem; margin-bottom: 20px;">
                        You scored ${sessionScore.correct}/${total} (${percentage}%)
                    </div>
                    <div style="margin-bottom: 30px; color: #666;">
                        Do you want to try again?
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="btn btn-primary" onclick="retrySession()">Yes, Try Again</button>
                        <button class="btn" style="background: #E5E7EB; color: #1D3557;" onclick="returnToLanguageHome()">No, Go Back</button>
                    </div>
                </div>
            `;
            
            document.getElementById('learningSession').innerHTML = tryAgainHTML;
        }

        function retrySession() {
            // Reset session and start over with same content
            currentIndex = 0;
            sessionScore = { correct: 0, wrong: 0 };
            
            // Restore the original flashcard HTML
            document.getElementById('learningSession').innerHTML = `
                <div class="flashcard-container">
                    <div class="card-stack">
                        <div class="flashcard" id="flashcard">
                            <div class="card-number" id="cardNumber">1 / 15</div>
                            <div class="card-content" id="cardContent">Click to start!</div>
                            <div class="card-context" id="cardContext"></div>
                            <div class="card-hint" id="cardHint">Click to see translation</div>
                            <button class="flip-btn" id="flipButton" onclick="flipCard()" style="display: none;">Flip Card</button>
                        </div>
                    </div>
                </div>
                <div class="action-buttons" id="flashcardButtons" style="display: none;">
                    <button class="btn btn-correct" onclick="markCorrect()">✓ I knew this</button>
                    <button class="btn btn-wrong" onclick="markWrong()">✗ I didn't know</button>
                    <button class="btn btn-next" onclick="nextCard()">Next →</button>
                </div>
            `;
            
            showFlashcard();
        }

        function returnToLanguageHome() {
            // Show the learning interface (language home) instead of language selection
            document.getElementById('learningSession').classList.add('hidden');
            document.getElementById('learningInterface').classList.remove('hidden');
            
            // Reset to topic selection
            document.getElementById('topicSelection').classList.remove('hidden');
            document.getElementById('sessionSettings').classList.add('hidden');
            
            // Clear previous topic selection
            document.querySelectorAll('.topic-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            selectedTopic = null;
            
            // Restore original flashcard HTML for next session
            document.getElementById('learningSession').innerHTML = `
                <div class="flashcard-container">
                    <div class="card-stack">
                        <div class="flashcard" id="flashcard">
                            <div class="card-number" id="cardNumber">1 / 15</div>
                            <div class="card-content" id="cardContent">Click to start!</div>
                            <div class="card-context" id="cardContext"></div>
                            <div class="card-hint" id="cardHint">Click to see translation</div>
                            <button class="flip-btn" id="flipButton" onclick="flipCard()" style="display: none;">Flip Card</button>
                        </div>
                    </div>
                </div>
                <div class="action-buttons" id="flashcardButtons" style="display: none;">
                    <button class="btn btn-correct" onclick="markCorrect()">✓ I knew this</button>
                    <button class="btn btn-wrong" onclick="markWrong()">✗ I didn't know</button>
                    <button class="btn btn-next" onclick="nextCard()">Next →</button>
                </div>
            `;
        }

        function hideAllSections() {
            document.getElementById('languageSelection').classList.add('hidden');
            document.getElementById('learningInterface').classList.add('hidden');
        }

        // Initialize
        console.log("App initialized!");
    </script>
</body>
</html> "
